
import markdown
import jinja2

from src.reports.stats import StatsReport
from src.reports.hosts import HostsReport
from src.reports.services import ServicesReport

class FinalReport:
    def __init__(self, nmap_report):
        self.nmap_report = nmap_report
        self.stats = StatsReport(self.nmap_report)
        self.hosts = HostsReport(self.nmap_report)
        self.services = ServicesReport(self.nmap_report)

    def html(self, tmpl, css):
        extensions = ['extra', 'smarty']

        # Nmap Scan result tab
        nmap_report_md = self.nmap_report.markdown()
        nmap_report_html = markdown.markdown(nmap_report_md, extensions=extensions, output_format='html5')

        stats_report_md = self.stats.markdown()
        stats_report_html = markdown.markdown(stats_report_md, extensions=extensions, output_format='html5')

        hosts_report_md = self.hosts.markdown()
        hosts_report_html = markdown.markdown(hosts_report_md, extensions=extensions, output_format='html5')

        services_report_md = self.services.markdown()
        services_report_html = markdown.markdown(services_report_md, extensions=extensions, output_format='html5')

        return jinja2.Template(tmpl).render(css=css, nmapresult=nmap_report_html, stats=stats_report_html, hosts=hosts_report_html, services=services_report_html)
